
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Interacting with Owl &#8212; Owl Numerical Library 0.3 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Architecture" href="arch.html" />
    <link rel="prev" title="Installation" href="install.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/owl_logo_4.png" alt="Logo"/>
    
  </a>
</p>











  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Interacting with Owl</a><ul>
<li><a class="reference internal" href="#using-toplevel">Using Toplevel</a></li>
<li><a class="reference internal" href="#using-notebook">Using Notebook</a></li>
<li><a class="reference internal" href="#using-owl-jupyter">Using owl-jupyter</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Part II: Owl Numerical System</a><ul>
      <li>Previous: <a href="install.html" title="previous chapter">Installation</a></li>
      <li>Next: <a href="arch.html" title="next chapter">Architecture</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="interacting-with-owl">
<h1>Interacting with Owl<a class="headerlink" href="#interacting-with-owl" title="Permalink to this headline">¶</a></h1>
<p>There are several ways to interact with Owl system. The most classic one is to write an OCaml application, compile the code, then run it natively on a computer. You can also skip the compilation step, and use Zoo system to run the code as a script.</p>
<p>However, the easiest way for a beginner to try out Owl is REPL (Read–Eval–Print Loop), or an interactive toplevel. The toplevel offers a convenient way to play with small code snippets. The code run in the toplevel is compiled into bytecode rather than native code. Bytecode often runs much slower than native code. However, this has very little impact on Owl’s performance because all its performance-critical functions are implemented in C language.</p>
<p>In the following, I will introduce two options to set up an interactive environment for Owl.</p>
<div class="section" id="using-toplevel">
<h2>Using Toplevel<a class="headerlink" href="#using-toplevel" title="Permalink to this headline">¶</a></h2>
<p>OCaml language has bundled with a simple toplevel, but I recommend to use <em>utop</em> as a more advance replacement. Installing <em>utop</em> is straightforward in OPAM, simply run the following command in the system shell.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>opam install utop
</pre></div>
</div>
<p>After installation, you can load Owl in <em>utop</em> with the following commands. <code class="docutils literal notranslate"><span class="pre">owl-toplevel</span></code> is Owl’s toplevel library which will automatically load several dependent libraries (including <code class="docutils literal notranslate"><span class="pre">owl-zoo</span></code>, <code class="docutils literal notranslate"><span class="pre">owl-base</span></code>, and <code class="docutils literal notranslate"><span class="pre">owl</span></code> core library) to set up a complete numerical environment.</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="o">#</span><span class="n">require</span> <span class="s2">&quot;owl-top&quot;</span><span class="o">;;</span>
<span class="k">open</span> <span class="nc">Owl</span><span class="o">;;</span>
</pre></div>
</div>
<p>If you do not want to type these commands every time you start <em>toplevel</em>, you can add them to <code class="docutils literal notranslate"><span class="pre">.ocamlinit</span></code> file. The toplevel reads <code class="docutils literal notranslate"><span class="pre">.ocamlinit</span></code> file when it starts and uses it to initialise the environment. This file is often stored in the home directory on your computer.</p>
</div>
<div class="section" id="using-notebook">
<h2>Using Notebook<a class="headerlink" href="#using-notebook" title="Permalink to this headline">¶</a></h2>
<p>Jupyter Notebook is a popular way to mix presentation with interactive code execution. It originates in Python world but is widely supported by various languages. One attractive feature of notebook is that it uses client/server architecture and runs in a browser.</p>
<p>If you want to know how to use a notebook and its technical details, please read <a class="reference external" href="http://jupyter.org/documentation">Jupyter Documentation</a>. Here let me show you how to set up a notebook to run Owl step by step.</p>
<p>Run the following commands in the shell will install all the dependency for you. This includes Jupyter Notebook and its <a class="reference external" href="https://github.com/akabe/ocaml-jupyter">OCaml language extension</a>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install jupyter
opam install jupyter
jupyter kernelspec install --name ocaml-jupyter <span class="s2">&quot;</span><span class="k">$(</span>opam config var share<span class="k">)</span><span class="s2">/jupyter&quot;</span>
</pre></div>
</div>
<p>To start a Jupyter notebook, you can run this command. The command starts a local server running on <code class="docutils literal notranslate"><span class="pre">http://127.0.0.1:8888/</span></code>, then opens a tab in your browser as the client.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>jupyter notebook
</pre></div>
</div>
<p>If you want to run a notebook server remotely, please refer to <a class="reference external" href="http://jupyter-notebook.readthedocs.io/en/stable/public_server.html">“Running a notebook server”</a>. If you want to set up a server for multiple users, please refer to <a class="reference external" href="https://jupyterhub.readthedocs.io/en/latest/">JupyterHub</a> system.</p>
<p>When everything is up and running, you can start a new notebook in the web interface. In the new notebook, you must run the following OCaml code in the first input field to load Owl environment.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#use &quot;topfind&quot;;;</span>
<span class="c1">#require &quot;owl-top, jupyter.notebook&quot;;;</span>
</pre></div>
</div>
<p>At this point, a complete Owl environment is set up in the Jupyter Notebook, and you are free to go with any experiments you like.</p>
<p>For example, you can simply copy &amp; paste the whole <a class="reference external" href="https://github.com/owlbarn/owl/blob/master/examples/lazy_mnist.ml">lazy_mnist.ml</a> to train a convolutional neural network in the notebook. But here, let us just use the following code.</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="o">#</span><span class="n">use</span> <span class="s2">&quot;topfind&quot;</span><span class="o">;;</span>
<span class="o">#</span><span class="n">require</span> <span class="s2">&quot;owl-top, jupyter.notebook&quot;</span><span class="o">;;</span>

<span class="k">open</span> <span class="nc">Owl</span>
<span class="k">open</span> <span class="nn">Neural</span><span class="p">.</span><span class="nc">S</span>
<span class="k">open</span> <span class="nn">Neural</span><span class="p">.</span><span class="nn">S</span><span class="p">.</span><span class="nc">Graph</span>
<span class="k">open</span> <span class="nn">Neural</span><span class="p">.</span><span class="nn">S</span><span class="p">.</span><span class="nc">Algodiff</span>


<span class="k">let</span> <span class="n">make_network</span> <span class="n">input_shape</span> <span class="o">=</span>
  <span class="n">input</span> <span class="n">input_shape</span>
  <span class="o">|&gt;</span> <span class="n">lambda</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="nn">Maths</span><span class="p">.</span><span class="o">(</span><span class="n">x</span> <span class="o">/</span> <span class="nc">F</span> <span class="mi">256</span><span class="o">.))</span>
  <span class="o">|&gt;</span> <span class="n">conv2d</span> <span class="o">[|</span><span class="mi">5</span><span class="o">;</span><span class="mi">5</span><span class="o">;</span><span class="mi">1</span><span class="o">;</span><span class="mi">32</span><span class="o">|]</span> <span class="o">[|</span><span class="mi">1</span><span class="o">;</span><span class="mi">1</span><span class="o">|]</span> <span class="o">~</span><span class="n">act_typ</span><span class="o">:</span><span class="nn">Activation</span><span class="p">.</span><span class="nc">Relu</span>
  <span class="o">|&gt;</span> <span class="n">max_pool2d</span> <span class="o">[|</span><span class="mi">2</span><span class="o">;</span><span class="mi">2</span><span class="o">|]</span> <span class="o">[|</span><span class="mi">2</span><span class="o">;</span><span class="mi">2</span><span class="o">|]</span>
  <span class="o">|&gt;</span> <span class="n">dropout</span> <span class="mi">0</span><span class="o">.</span><span class="mi">1</span>
  <span class="o">|&gt;</span> <span class="n">fully_connected</span> <span class="mi">1024</span> <span class="o">~</span><span class="n">act_typ</span><span class="o">:</span><span class="nn">Activation</span><span class="p">.</span><span class="nc">Relu</span>
  <span class="o">|&gt;</span> <span class="n">linear</span> <span class="mi">10</span> <span class="o">~</span><span class="n">act_typ</span><span class="o">:</span><span class="nn">Activation</span><span class="p">.</span><span class="o">(</span><span class="nc">Softmax</span> <span class="mi">1</span><span class="o">)</span>
  <span class="o">|&gt;</span> <span class="n">get_network</span>
  <span class="o">;;</span>


<span class="n">make_network</span> <span class="o">[|</span><span class="mi">28</span><span class="o">;</span><span class="mi">28</span><span class="o">;</span><span class="mi">1</span><span class="o">|];;</span>
</pre></div>
</div>
<p>Jupyter notebook should nicely print out the structure of the neural network.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/jupyter_example_01.png"><img alt="jupyter example 01" src="../_images/jupyter_example_01.png" style="width: 577.0px; height: 828.0px;" /></a>
</div>
<p>Second example demonstrates how to plot figures in notebook. Because Owl’s Plot module does not support in-memory plotting, the figure needs to be written into a file first then passed to <code class="docutils literal notranslate"><span class="pre">Jupyter_notebook.display_file</span></code> to render.</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="o">#</span><span class="n">use</span> <span class="s2">&quot;topfind&quot;</span><span class="o">;;</span>
<span class="o">#</span><span class="n">require</span> <span class="s2">&quot;owl-top, jupyter.notebook&quot;</span><span class="o">;;</span>
<span class="k">open</span> <span class="nc">Owl</span><span class="o">;;</span>

<span class="c">(* Plot a normal figure using Plot *)</span>

<span class="k">let</span> <span class="n">f</span> <span class="n">x</span> <span class="o">=</span> <span class="nn">Maths</span><span class="p">.</span><span class="n">sin</span> <span class="n">x</span> <span class="o">/.</span> <span class="n">x</span> <span class="k">in</span>
<span class="k">let</span> <span class="n">h</span> <span class="o">=</span> <span class="nn">Plot</span><span class="p">.</span><span class="n">create</span> <span class="s2">&quot;plot_003.png&quot;</span> <span class="k">in</span>
<span class="nn">Plot</span><span class="p">.</span><span class="n">set_foreground_color</span> <span class="n">h</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span><span class="o">;</span>
<span class="nn">Plot</span><span class="p">.</span><span class="n">set_background_color</span> <span class="n">h</span> <span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="o">;</span>
<span class="nn">Plot</span><span class="p">.</span><span class="n">set_title</span> <span class="n">h</span> <span class="s2">&quot;Function: f(x) = sine x / x&quot;</span><span class="o">;</span>
<span class="nn">Plot</span><span class="p">.</span><span class="n">set_xlabel</span> <span class="n">h</span> <span class="s2">&quot;x-axis&quot;</span><span class="o">;</span>
<span class="nn">Plot</span><span class="p">.</span><span class="n">set_ylabel</span> <span class="n">h</span> <span class="s2">&quot;y-axis&quot;</span><span class="o">;</span>
<span class="nn">Plot</span><span class="p">.</span><span class="n">set_font_size</span> <span class="n">h</span> <span class="mi">8</span><span class="o">.;</span>
<span class="nn">Plot</span><span class="p">.</span><span class="n">set_pen_size</span> <span class="n">h</span> <span class="mi">3</span><span class="o">.;</span>
<span class="nn">Plot</span><span class="p">.</span><span class="n">plot_fun</span> <span class="o">~</span><span class="n">h</span> <span class="n">f</span> <span class="mi">1</span><span class="o">.</span> <span class="mi">15</span><span class="o">.;</span>
<span class="nn">Plot</span><span class="p">.</span><span class="n">output</span> <span class="n">h</span><span class="o">;;</span>

<span class="c">(* Load into memory and display in Jupyter *)</span>

<span class="nn">Jupyter_notebook</span><span class="p">.</span><span class="n">display_file</span> <span class="o">~</span><span class="n">base64</span><span class="o">:</span><span class="bp">true</span> <span class="s2">&quot;image/png&quot;</span> <span class="s2">&quot;plot_003.png&quot;</span>
</pre></div>
</div>
<p>Then we can see the plot is correctly rendered in the notebook running in your browser. Plotting capability greatly enriches the content of an interactive presentation.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/jupyter_example_02.png"><img alt="jupyter example 02" src="../_images/jupyter_example_02.png" style="width: 579.0px; height: 717.0px;" /></a>
</div>
</div>
<div class="section" id="using-owl-jupyter">
<h2>Using owl-jupyter<a class="headerlink" href="#using-owl-jupyter" title="Permalink to this headline">¶</a></h2>
<p>There is a convenient library <cite>owl-jupyter</cite> specifically for running Owl in a notebook. The library is a thin wrapper of <code class="docutils literal notranslate"><span class="pre">owl-top</span></code>. The biggest difference is that it overwrites <code class="docutils literal notranslate"><span class="pre">Plot.output</span></code> function so the figure is automatically rendered in the notebook without calling <code class="docutils literal notranslate"><span class="pre">Jupyter_notebook.display_file</span></code>.</p>
<p>This means that all the plotting code can be directly used in the notebook without any modifications. Please check the following example and compare it with the previous plotting example, we can see <code class="docutils literal notranslate"><span class="pre">display_file</span></code> call is saved.</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="o">#</span><span class="n">use</span> <span class="s2">&quot;topfind&quot;</span><span class="o">;;</span>
<span class="o">#</span><span class="n">require</span> <span class="s2">&quot;owl-jupyter&quot;</span><span class="o">;;</span>
<span class="k">open</span> <span class="nc">Owl_jupyter</span><span class="o">;;</span>

<span class="k">let</span> <span class="n">f</span> <span class="n">x</span> <span class="o">=</span> <span class="nn">Maths</span><span class="p">.</span><span class="n">sin</span> <span class="n">x</span> <span class="o">/.</span> <span class="n">x</span> <span class="k">in</span>
<span class="k">let</span> <span class="n">g</span> <span class="n">x</span> <span class="o">=</span> <span class="nn">Maths</span><span class="p">.</span><span class="n">cos</span> <span class="n">x</span> <span class="o">/.</span> <span class="n">x</span> <span class="k">in</span>
<span class="k">let</span> <span class="n">h</span> <span class="o">=</span> <span class="nn">Plot</span><span class="p">.</span><span class="n">create</span> <span class="s2">&quot;&quot;</span> <span class="k">in</span>
<span class="nn">Plot</span><span class="p">.</span><span class="n">set_foreground_color</span> <span class="n">h</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span><span class="o">;</span>
<span class="nn">Plot</span><span class="p">.</span><span class="n">set_background_color</span> <span class="n">h</span> <span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="o">;</span>
<span class="nn">Plot</span><span class="p">.</span><span class="n">set_pen_size</span> <span class="n">h</span> <span class="mi">3</span><span class="o">.;</span>
<span class="nn">Plot</span><span class="p">.</span><span class="n">plot_fun</span> <span class="o">~</span><span class="n">h</span> <span class="n">f</span> <span class="mi">1</span><span class="o">.</span> <span class="mi">15</span><span class="o">.;</span>
<span class="nn">Plot</span><span class="p">.</span><span class="n">plot_fun</span> <span class="o">~</span><span class="n">h</span> <span class="n">g</span> <span class="mi">1</span><span class="o">.</span> <span class="mi">15</span><span class="o">.;</span>
<span class="nn">Plot</span><span class="p">.</span><span class="n">output</span> <span class="n">h</span><span class="o">;;</span>
</pre></div>
</div>
<p>One thing worth noting is that, if you pass in empty string in <code class="docutils literal notranslate"><span class="pre">Plot.create</span></code> function, the figure is only rendered in the browser. If you pass in non-empty string, then the figure is both rendered in the browser and saved into the file you specified. This is to guarantee <code class="docutils literal notranslate"><span class="pre">output</span></code> function has the consistent behaviour when used in or out of a notebook.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/jupyter_example_03.png"><img alt="jupyter example 03" src="../_images/jupyter_example_03.png" style="width: 577.0px; height: 612.0px;" /></a>
</div>
</div>
</div>


          </div>
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2018, <a href="http://www.cl.cam.ac.uk/~lw525/">Liang Wang</a>   | <a href="http://www.cl.cam.ac.uk/">Computer Lab, University of Cambridge</a>.
      
      |
      <a href="../_sources/chapter/interact.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>